!function(t){function s(t,i,s){function m(t){var o=t.getViewport(s.scale),e=document.createElement("canvas"),a=e.getContext("2d"),c={canvasContext:a,viewport:o};e.setAttribute("id","page"+t.pageIndex),e.height=o.height,e.width=i.offsetWidth,n.options.canvas_width=e.width,n.options.canvas_height=e.height,i.appendChild(e),task=t.render(c),task.promise.then(function(){u++,""===v&&t.transport.numPages==u&&(n.options.pdfobj=t,console.log(t),x(0),v=1)})}function x(t){if(""==v){if(v="true",n.options.PrevPage=t,n.options.activePage=t,o=document.getElementById("canvas"),e=o.getContext("2d"),n.initial_canvas_url.hasOwnProperty(t))imgURL=n.final_canvas_url[n.options.activePage];else{var i=document.getElementById("page"+t);n.initial_canvas_url[t]=i.toDataURL(),n.final_canvas_url[n.options.activePage]=n.initial_canvas_url[n.options.activePage],imgURL=n.initial_canvas_url[n.options.activePage]}o.height=n.options.canvas_height,o.width=n.options.canvas_width;var s=new Element("img",{src:imgURL});s.onload=function(){canvas_coords=o.getCoordinates(),n.options.canvas_coords=canvas_coords,e.clearRect(0,0,o.width,o.height),e.drawImage(s,0,0,o.width,o.height),document.getElementById("loading").textContent="",n.saveState(o),f===!1&&(f=!0,document.getElementById("pencil").addEventListener("click",function(){a.options.activeTool=p,p.init(o,e)}),document.getElementById("square").addEventListener("click",function(){a.options.activeTool=g,g.init(o,e)}),document.getElementById("circle").addEventListener("click",function(){a.options.activeTool=l,l.init(o,e)}),document.getElementById("text").addEventListener("click",function(){a.options.activeTool=c,c.init(o,e)}),document.getElementById("contenteditor").addEventListener("blur",function(){document.getElementById("editor_wrapper").style.display="none",c.drawTool()}),document.getElementById("arrow").addEventListener("click",function(){a.options.activeTool=r,r.init(o,e)}),document.getElementById("line").addEventListener("click",function(){a.options.activeTool=d,d.init(o,e)}),document.getElementById("imageupload").addEventListener("change",function(){console.log(this.files[0]),h.uploadImage(this.files[0]),a.options.activeTool=h,h.init(o,e)}),document.getElementById("clear_image").addEventListener("click",function(){document.getElementById("frm_canvas_tool").reset()}),document.getElementById("undo").addEventListener("click",function(){n.undo(o,e)}),document.getElementById("redo").addEventListener("click",function(){n.redo(o,e)}),document.getElementById("save").addEventListener("click",function(){a.savepdf()}),document.getElementById("fontsize").addEventListener("change",function(){n.options.font_size=this.value}),document.getElementById("fillstyle").addEventListener("change",function(){n.options.fillStyle="#"+this.value}),document.getElementById("linewidth").addEventListener("change",function(){n.options.lineWidth=this.value}),document.getElementById("prevBtn").addEventListener("click",function(){document.getElementById("prevBtn").getAttribute("disable")||(v="",x(parseInt(n.options.activePage-1)))}),document.getElementById("nextBtn").addEventListener("click",function(){document.getElementById("nextBtn").getAttribute("disabled")||(v="",x(parseInt(n.options.activePage+1)))})),a.init(o,e)}}}function _(t){n.options.numPages=t.numPages;for(var i=1;i<=t.numPages;i++)t.getPage(i).then(m)}var s=s||{scale:2};document.getElementById("loading").textContent="Wait while loading PDF file...",PDFJS.disableWorker=!1,PDFJS.getDocument(t).then(_)}var o,e,n={options:{canvas_width:"",canvas_height:"",activePage:0,totalPage:1,enablePrevBtn:!1,enableNextBtn:!1,font_size:14,fillStyle:"#FF0000",lineWidth:2},initial_canvas_url:[],final_canvas_url:[],redo_list:[],undo_list:[],setStyleElement:function(t,i){i.fillStyle=this.options.fillStyle,i.font=this.options.font_size+"px Calibri",i.lineWidth=this.options.lineWidth,i.strokeStyle=this.options.fillStyle},saveState:function(t,i,s){s=s||!1,s||(this.redo_list=[]),this.undo_list.hasOwnProperty(this.options.activePage)||(this.undo_list[this.options.activePage]=[]);var o=t.toDataURL();i?(i.hasOwnProperty(this.options.activePage)||(i[this.options.activePage]=[]),i[this.options.activePage].push(o)):this.undo_list[this.options.activePage].push(o),n.final_canvas_url[n.options.PrevPage]=o},undo:function(t,i){this.options.action="undo",this.restoreState(t,i,this.undo_list,this.redo_list)},redo:function(t,i){this.options.action="redo",this.restoreState(t,i,this.redo_list,this.undo_list)},restoreState:function(t,i,s,o){var e=s[this.options.activePage];if(e.length){if(o&&"undo"==this.options.action&&this.saveState(t,o,!0),"undo"==this.options.action){var a=e.pop();if(e.length)var c=e[e.length-1];else var c=a}else{var a=e.pop(),c=a;this.undo_list[this.options.activePage].push(a)}var h=new Element("img",{src:c});h.onload=function(){i.clearRect(0,0,n.options.canvas_width,n.options.canvas_height),i.drawImage(h,0,0,n.options.canvas_width,n.options.canvas_height)}}},drawingState:function(t,i,s){if(s[this.options.activePage].length){var o=s[this.options.activePage][s[this.options.activePage].length-1],e=new Element("img",{src:o});e.onload=function(){i.clearRect(0,0,n.options.canvas_width,n.options.canvas_height),i.drawImage(e,0,0,n.options.canvas_width,n.options.canvas_height),a.options.activeTool.drawTool()}}}},a={options:{activeTool:p},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.paging(),this.addCanvasEvents()},addCanvasEvents:function(){this.canvas.addEvent("mousedown",this.start.bind(this)),this.canvas.addEvent("mousemove",this.stroke.bind(this)),this.canvas.addEvent("mouseup",this.stop.bind(this)),this.canvas.addEvent("mouseout",this.stop.bind(this))},start:function(t){void 0!==this.options.activeTool&&this.options.activeTool.start(t)},stroke:function(t){void 0!==this.options.activeTool&&this.options.activeTool.stroke(t)},stop:function(t){void 0!==this.options.activeTool&&this.options.activeTool.stop(t)},savepdf:function(){console.log(n.options.pdfobj);var t=confirm("Are you sure to Save ");if(t){var s=new jsPDF("p","mm","a4");for(i=0;i<parseInt(n.options.totalPage);i++)if(i<2){if(n.final_canvas_url.hasOwnProperty(i))var o=n.final_canvas_url[i];else var o=document.getElementById("page"+i).toDataURL("image/png");s.addImage(o,"PNG",0,0,200,250),i<parseInt(n.options.totalPage-1)&&s.addPage(),console.log(s)}s.save("sample-file.pdf")}},paging:function(){n.options.totalPage=n.options.pdfobj.transport.numPages,document.getElementById("activePage").textContent=n.options.activePage+1,document.getElementById("currentPage").value=n.options.activePage+1,document.getElementById("totalPage").textContent=n.options.totalPage,0===n.options.activePage?(document.getElementById("prevBtn").setAttribute("disabled","disabled"),document.getElementById("nextBtn").removeAttribute("disabled")):parseInt(n.options.activePage)===parseInt(n.options.totalPage-1)?(document.getElementById("nextBtn").setAttribute("disabled","disabled"),document.getElementById("prevBtn").removeAttribute("disabled")):n.options.activePage>0&&parseInt(n.options.activePage)<parseInt(n.options.totalPage-1)&&(document.getElementById("prevBtn").removeAttribute("disabled"),document.getElementById("nextBtn").removeAttribute("disabled"))}},c={options:{stroke_color:["00","00","00"],fill_color:"red",font:"14px Calibri",dim:4,lineHeight:14},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.ctx.fillStyle="rgba(0,0,0,0)",this.drawing=!1,this.options.flag=!0},start:function(t){if(this.options.flag){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.startX=i,this.options.startY=s,this.ctx.fillStyle=this.options.fill_color,this.ctx.font=this.options.font,this.ctx.beginPath(),this.drawing=!0}},stroke:function(t){if(this.options.flag&&this.drawing){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.endX=i,this.options.endY=s}},stop:function(t){this.drawing&&this.options.flag&&(console.log("inside stop if drwing"),this.drawing=!1,this.options.flag=!1,this.options.lineHeight=parseInt(n.options.font_size),document.getElementById("editor_wrapper").style.display="block",document.getElementById("editor_wrapper").style.top=this.options.startY+this.canvas_coords.top-10,document.getElementById("editor_wrapper").style.left=this.options.startX+this.canvas_coords.left,document.getElementById("editor_wrapper").style.width=this.options.endX-this.options.startX,document.getElementById("contenteditor").focus(),document.getElementById("contenteditor").style.minHeight=parseInt(this.options.endY-this.options.startY),console.log(n.options.font_size))},drawTool:function(){console.log("Inside circle drawtool"),n.setStyleElement(this.canvas,this.ctx),document.getElementById("contenteditor").style.fontSize=n.options.font_size,document.getElementById("contenteditor").style.lineHeight=n.options.font_size+"px",document.getElementById("contenteditor").style.height=document.getElementById("contenteditor").scrollHeight+"px";var t=document.getElementById("contenteditor").value,i=escape(t);if(t=unescape(i.replace(/%0A/g,"<br />").replace(/%20/g," ")),document.getElementById("contenteditor").value="",""!==t){var s={text:t,x:this.options.startX,y:this.options.startY,boxWidth:this.options.endX-this.options.startX};this.drawStyledText(s)}},drawStyledText:function(t){var i,s,o,e,a,c,h=t.text,r=t.x,d=t.y,l=[],p=t.boxWidth,g=h.match(/<\s*br\s*\/>|<\s*class=["|']([^"|']+)["|']\s*\>([^>]+)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([^>]+)<\s*\/style\s*\>|[^<]+/g);for(e=0;e<g.length;e++)if(/<\s*br\s*\/>/i.test(g[e]))d+=1.5*parseInt(this.options.lineHeight,10),r=t.x;else{if(o=g[e],l=[],o=o.replace(/\s*\n\s*/g," "),void 0!==p&&this.checkLineBreak(o,p+t.x,r))if(i=this.trim(o).split(" "),1==i.length)l.push({text:this.trim(o)+" ",linebreak:!0});else{s=r;var v=0;for(l[v]={text:void 0,linebreak:!1},a=0;a<i.length;a++)i[a]+=" ",this.checkLineBreak(i[a],p+t.x,s)?(s=t.x,void 0!==l[v].text&&v++,l[v]={text:i[a],linebreak:!0},s+=this.ctx.measureText(i[a]).width):(void 0==l[v].text?l[v].text=i[a]:l[v].text+=i[a],s+=this.ctx.measureText(i[a]).width)}for(0==l.length&&l.push({text:this.trim(o)+" ",linebreak:!1}),c=0;c<l.length;c++)l[c].linebreak&&(d+=parseInt(this.options.lineHeight,10),r=t.x,this.options.endY=d),this.ctx.fillText(l[c].text,r,d),r+=this.ctx.measureText(l[c].text).width;this.ctx.stroke(),n.saveState(this.canvas)}},checkLineBreak:function(t,i,s){return this.ctx.measureText(t).width+s>i},trim:function(t){var i,s;for(t=t.replace(/^\s\s*/,""),i=/\s/,s=t.length;i.test(t.charAt(--s)););return t.slice(0,s+1)}},h={options:{activeImage:"",uploadedImage:[],width:"",height:"",wdthHghtRatio:"",img:""},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.drawing=!1},start:function(t){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.startX=i,this.options.startY=s,this.ctx.beginPath(),this.drawing=!0},stroke:function(t){if(this.drawing){n.drawingState(this.canvas,this.ctx,n.undo_list);var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.endX=i,this.options.endY=s,this.drawTool()}},stop:function(t){this.drawing&&(this.ctx.beginPath(),this.drawTool(),this.ctx.closePath(),this.ctx.stroke(),n.saveState(this.canvas),this.drawing=!1)},drawTool:function(){this.ctx.beginPath(),n.setStyleElement(this.canvas,this.ctx),this.options.width=parseInt(this.options.endX-this.options.startX),this.options.height=parseInt(this.options.endY-this.options.startY),this.ctx.drawImage(this.options.img,this.options.startX,this.options.startY,this.options.width,this.options.height)},uploadImage:function(t){var i=new Image;i.onload=function(t){},i.src=URL.createObjectURL(t),this.options.uploadedImage.push(i.src),this.options.img=i}},r={options:{stroke_color:["00","00","00"],dim:4,arrow:{h:5,w:10},headlen:10},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.ctx.fillStyle="rgba(0,0,0,0)",this.drawing=!1},start:function(t){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.startX=i,this.options.startY=s,this.ctx.beginPath(),this.drawing=!0},stroke:function(t){if(this.drawing){n.drawingState(this.canvas,this.ctx,n.undo_list);var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.endX=i,this.options.endY=s,this.drawTool()}},stop:function(t){this.drawing&&(this.ctx.beginPath(),this.drawTool(),this.ctx.closePath(),this.ctx.stroke(),n.saveState(this.canvas),this.drawing=!1)},drawTool:function(){this.ctx.beginPath(),n.setStyleElement(this.canvas,this.ctx);var t=Math.atan2(this.options.endY-this.options.startY,this.options.endX-this.options.startX);this.ctx.moveTo(this.options.startX,this.options.startY),this.ctx.lineTo(this.options.endX,this.options.endY),this.ctx.lineTo(this.options.endX-this.options.headlen*Math.cos(t-Math.PI/6),this.options.endY-this.options.headlen*Math.sin(t-Math.PI/6)),this.ctx.moveTo(this.options.endX,this.options.endY),this.ctx.lineTo(this.options.endX-this.options.headlen*Math.cos(t+Math.PI/6),this.options.endY-this.options.headlen*Math.sin(t+Math.PI/6)),this.ctx.stroke()}},d={options:{stroke_color:["00","00","00"],dim:4},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.ctx.fillStyle="rgba(0,0,0,0)",this.drawing=!1},start:function(t){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.startX=i,this.options.startY=s,this.ctx.beginPath(),this.drawing=!0},stroke:function(t){if(this.drawing){n.drawingState(this.canvas,this.ctx,n.undo_list);var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.endX=i,this.options.endY=s,this.drawTool()}},stop:function(t){this.drawing&&(this.ctx.beginPath(),this.drawTool(),this.ctx.closePath(),this.ctx.stroke(),n.saveState(this.canvas),this.drawing=!1)},drawTool:function(){this.ctx.beginPath(),n.setStyleElement(this.canvas,this.ctx);Math.atan2(this.options.endY-this.options.startY,this.options.endX-this.options.startX);this.ctx.moveTo(this.options.startX,this.options.startY),this.ctx.lineTo(this.options.endX,this.options.endY),this.ctx.stroke()}},l={options:{stroke_color:["00","00","00"],dim:4},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.ctx.fillStyle="rgba(0,0,0,0)",this.drawing=!1},start:function(t){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.startX=i,this.options.startY=s,this.ctx.beginPath(),this.drawing=!0},stroke:function(t){if(this.drawing){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.endX=i,this.options.endY=s,n.drawingState(this.canvas,this.ctx,n.undo_list)}},stop:function(t){this.drawing&&(this.drawTool(),this.ctx.closePath(),this.ctx.stroke(),n.saveState(this.canvas),this.drawing=!1)},drawTool:function(){if(this.drawing){n.setStyleElement(this.canvas,this.ctx);var t=parseInt(this.options.endX-this.options.startX),i=parseInt(this.options.endY-this.options.startY),s=t+i,o=2*Math.PI/s;this.ctx.beginPath();for(var e=0;e<2*Math.PI;e+=o){var a=t+s*Math.cos(e),c=i-s*Math.sin(e);this.ctx.lineTo(a+this.options.startX,c+this.options.startY)}this.ctx.stroke()}}},p={options:{stroke_color:["00","00","00"],dim:4},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.fillStyle,this.drawing=!1,n.setStyleElement(this.canvas,this.ctx)},start:function(t){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.ctx.beginPath(),this.ctx.moveTo(i,s),this.drawing=!0},stroke:function(t){if(this.drawing){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.ctx.lineTo(i,s),this.ctx.stroke()}},stop:function(t){this.drawing&&(n.saveState(this.canvas),this.drawing=!1)},drawTool:function(){}},g={options:{stroke_color:["00","00","00"],dim:4},init:function(t,i){this.canvas=t,this.canvas_coords=this.canvas.getCoordinates(),this.ctx=i,this.ctx.strokeColor=this.options.stroke_color,this.drawing=!1},start:function(t){var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.startX=i,this.options.startY=s,this.ctx.beginPath(),this.drawing=!0},stroke:function(t){if(this.drawing){n.drawingState(this.canvas,this.ctx,n.undo_list),this.ctx.beginPath();var i=t.page.x-this.canvas_coords.left,s=t.page.y-this.canvas_coords.top;this.options.endX=i,this.options.endY=s,this.drawTool()}},stop:function(t){this.drawing&&(this.ctx.beginPath(),this.options.width=this.options.endX-this.options.startX,this.options.height=this.options.endY-this.options.startY,this.drawTool(),this.ctx.stroke(),n.saveState(this.canvas),this.drawing=!1)},drawLine:function(t,i){n.setStyleElement(this.canvas,this.ctx),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke()},drawTool:function(){lineP1={x:this.options.startX,y:this.options.startY,r:0},lineP2={x:this.options.startX,y:this.options.endY,r:0},lineP3={x:this.options.endX,y:this.options.endY,r:0},lineP4={x:this.options.endX,y:this.options.startY,r:0},this.drawLine(lineP1,lineP2),this.drawLine(lineP2,lineP3),this.drawLine(lineP3,lineP4),this.drawLine(lineP4,lineP1)}},v="",u=0,f=!1;s("demo.pdf",document.getElementById("canvas-container"))}(document.id),$(window).scroll(function(){var t=90,i=$(window).scrollTop();i>t?$("#controllers").css({position:"fixed"}):$("#controllers").css({position:"relative"})});